{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if is_edit %}Edit Article{% else %}Write Article{% endif %} - Madison Magazine</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff66b2;
            --secondary: #ff99cc;
            --accent: #ff3385;
            --dark: #33001a;
            --darker: #1a000d;
            --light: #fff0f5;
            --glass: rgba(255, 102, 178, 0.2);
            --neon-glow: 0 0 10px rgba(255, 51, 153, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--darker);
            color: var(--light);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Background Slideshow */
        .slideshow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            opacity: 0.3;
            filter: blur(5px);
        }

        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .slide.active {
            opacity: 1;
        }

        /* Glitter Effect */
        .glitter-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ff3385' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        /* Main Layout */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(255, 102, 178, 0.5);
            margin-bottom: 2rem;
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-decoration: none;
            position: relative;
        }

        .logo::after {
            content: "üå∏";
            position: absolute;
            right: -25px;
            top: 0;
            font-size: 1.2rem;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
        }

        .nav-link {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            position: relative;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--accent);
        }

        .nav-link.active {
            color: var(--accent);
            font-weight: 600;
        }

        .nav-link.active::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
            border-radius: 2px;
        }

        /* Editor Section */
        .editor-container {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(255, 102, 178, 0.3);
            box-shadow: 0 0 20px rgba(255, 102, 178, 0.2);
        }

        .editor-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-title .title-sparkle {
            font-size: 1.2rem;
            animation: sparkle 2s infinite;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .glow-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .label-icon {
            font-size: 1.1rem;
        }

        .glow-input, .glow-textarea, .glow-select {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(51, 0, 26, 0.7);
            border: 1px solid rgba(255, 102, 178, 0.5);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .glow-input:focus, .glow-textarea:focus, .glow-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: var(--neon-glow);
        }

        .glow-input::placeholder, .glow-textarea::placeholder {
            color: rgba(255, 240, 245, 0.6);
        }

        .input-container {
            position: relative;
        }

        .char-counter {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: rgba(255, 240, 245, 0.6);
        }

        .input-underline {
            height: 2px;
            background: linear-gradient(90deg, var(--accent), transparent);
            width: 0;
            transition: width 0.3s ease;
            margin-top: 5px;
        }

        .glow-input:focus ~ .input-underline,
        .glow-textarea:focus ~ .input-underline {
            width: 100%;
        }

        /* Image Upload */
        .image-upload-container {
            margin-top: 0.5rem;
        }

        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed rgba(255, 102, 178, 0.5);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview:hover {
            border-color: var(--accent);
        }

        .image-preview.dragover {
            background: rgba(255, 102, 178, 0.2);
            border-color: var(--accent);
        }

        .upload-placeholder {
            text-align: center;
            color: rgba(255, 240, 245, 0.6);
        }

        .upload-icon {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .preview-image, .current-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-image:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        .hidden-upload {
            display: none;
        }

        /* Tags Input */
        .tags-container {
            margin-top: 0.5rem;
        }

        #tag-input {
            margin-bottom: 0.5rem;
        }

        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: rgba(255, 102, 178, 0.3);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .remove-tag {
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .remove-tag:hover {
            color: var(--accent);
            transform: scale(1.2);
        }

        /* Content Box */
        .content-box {
            width: 100%;
            min-height: 300px;
            background: rgba(255, 102, 178, 0.1);
            border: 2px dashed rgba(255, 102, 178, 0.5);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: rgba(255, 240, 245, 0.7);
            font-size: 1.1rem;
            position: relative;
        }

        .content-box:hover {
            background: rgba(255, 102, 178, 0.2);
            border-color: var(--accent);
            color: var(--light);
        }

        .content-box-content {
            padding: 1rem;
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }

        /* Side Panel */
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 102, 178, 0.3);
            box-shadow: 0 0 15px rgba(255, 102, 178, 0.2);
        }

        .panel-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: var(--light);
        }

        .panel-icon {
            font-size: 1.2rem;
        }

        .panel-content {
            color: rgba(255, 240, 245, 0.8);
        }

        /* Tips List */
        .tips-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .tips-list li {
            position: relative;
            padding-left: 1.5rem;
        }

        .tips-list li::before {
            content: "üå∏";
            position: absolute;
            left: 0;
            color: var(--accent);
            font-size: 0.8rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 240, 245, 0.3);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .setting-item {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        /* Validation Panel */
        .validation-list {
            list-style: none;
        }

        .validation-list li {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }

        .status {
            font-weight: 500;
        }

        /* Action Buttons */
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                transparent 45%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 55%
            );
            transform: rotate(30deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .action-btn:hover::before {
            animation: shine 1.5s;
        }

        @keyframes shine {
            0% { left: -50%; opacity: 0; }
            50% { opacity: 1; }
            100% { left: 150%; opacity: 0; }
        }

        .preview-btn {
            background: rgba(255, 240, 245, 0.2);
            color: var(--light);
            border: 1px solid rgba(255, 102, 178, 0.7);
        }

        .preview-btn:hover {
            background: rgba(255, 240, 245, 0.3);
            box-shadow: var(--neon-glow);
        }

        .draft-btn {
            background: rgba(255, 240, 245, 0.1);
            color: var(--light);
        }

        .draft-btn:hover {
            background: rgba(255, 240, 245, 0.2);
            box-shadow: 0 0 10px rgba(255, 240, 245, 0.3);
        }

        .publish-btn {
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            color: white;
        }

        .publish-btn:hover {
            box-shadow: var(--neon-glow);
            transform: translateY(-2px);
        }

        .publish-btn:disabled {
            background: rgba(255, 240, 245, 0.2);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-sparkle {
            font-size: 0.9rem;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: rgba(255, 182, 193, 0.9);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 102, 178, 0.5);
            box-shadow: 0 0 30px rgba(255, 102, 178, 0.5);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: rgba(255, 240, 245, 0.6);
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }

        .preview-content {
            margin: 1.5rem 0;
            line-height: 1.6;
            color: var(--darker);
        }

        .preview-content h1 {
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .preview-description {
            font-style: italic;
            color: rgba(51, 0, 26, 0.8);
            margin-bottom: 2rem;
        }

        .preview-body {
            margin-top: 2rem;
        }

        .preview-body p {
            margin-bottom: 1rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
        }

        /* Content Popup */
        .content-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(51, 0, 26, 0.9);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background: rgba(255, 192, 203, 0.9);
            border-radius: 15px;
            padding: 2rem;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            border: 1px solid rgba(255, 102, 178, 0.5);
            box-shadow: 0 0 30px rgba(255, 102, 178, 0.5);
            position: relative;
            color: var(--darker);
            animation: bounceIn 0.4s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.9); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .popup-content h2 {
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .popup-content textarea {
            width: 100%;
            min-height: 400px;
            padding: 1rem;
            background: rgba(255, 240, 245, 0.8);
            border: 1px solid rgba(255, 102, 178, 0.5);
            border-radius: 8px;
            color: var(--darker);
            font-size: 1rem;
            margin-bottom: 1rem;
            resize: vertical;
        }

        .popup-content button {
            padding: 0.8rem 1.5rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .popup-content button:hover {
            background: var(--secondary);
            box-shadow: var(--neon-glow);
        }

        .close-popup {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: rgba(51, 0, 26, 0.6);
            transition: all 0.3s ease;
        }

        .close-popup:hover {
            color: var(--accent);
            transform: rotate(90deg);
        }

        /* Error Popup */
        .error-popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 182, 193, 0.95);
            color: #800020;
            border: 1px solid #ff69b4;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
            z-index: 3000;
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { top: -50px; opacity: 0; }
            to { top: 20px; opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .side-panel {
                grid-row: 1;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .validation-panel {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                width: 100%;
                justify-content: center;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .side-panel {
                grid-template-columns: 1fr;
            }
            
            .modal-content, .popup-content {
                width: 95%;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Background Slideshow -->
    <div class="slideshow">
        <div class="slide active" style="background-image: url('https://i.pinimg.com/736x/7c/6f/b4/7c6fb4a0c8b45fd037f802e5ece7fb08.jpg');"></div>
        <div class="slide" style="background-image: url('https://i.pinimg.com/736x/fb/ff/07/fbff072769b0eed6df2d42b464dfd36b.jpg');"></div>
        <div class="slide" style="background-image: url('https://i.pinimg.com/736x/f5/81/2d/f5812df6a72ba542feac7df7da1f76ad.jpg');"></div>
    </div>
    
    <div class="glitter-bg"></div>
    
    <!-- Error Popup -->
    <div class="error-popup" id="error-popup">
        <i class="fas fa-exclamation-circle me-2"></i>
        <span id="error-message">Failed to load editor. Please refresh the page.</span>
    </div>
    
    <div class="container">
        <header class="header">
            <a href="#" class="logo">Madison</a>
            <nav class="nav-links">
                <a href="#" class="nav-link">Dashboard</a>
                <a href="#" class="nav-link active">Write</a>
                <a href="#" class="nav-link">Drafts</a>
                <a href="#" class="nav-link">Logout</a>
            </nav>
        </header>
        
        <main class="editor-container">
            <h1 class="editor-title">
                <span class="title-sparkle">üå∏</span>
                {% if is_edit %}Edit Your Article{% else %}Write New Article{% endif %}
            </h1>

            <form id="article-form" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="status" id="status" value="{{ article.status|default:'draft' }}">
                
                <div class="form-group">
                    <label for="title" class="glow-label">
                        <span class="label-icon">üìù</span>
                        Title
                    </label>
                    <div class="input-container">
                        <input type="text" id="title" name="title" required 
                               placeholder="Your captivating headline..." 
                               value="{{ article.title|default:'' }}"
                               class="glow-input">
                        <div class="char-counter"><span id="title-count">0</span>/100</div>
                    </div>
                    <span id="title-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                    <div class="input-underline"></div>
                </div>

                <div class="form-group">
                    <label for="description" class="glow-label">
                        <span class="label-icon">üîç</span>
                        Description
                    </label>
                    <textarea id="description" name="description" required 
                              placeholder="A brief summary of your article..."
                              class="glow-textarea">{{ article.description|default:'' }}</textarea>
                    <span id="description-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                    <div class="input-underline"></div>
                </div>

                <div class="form-group">
                    <label class="glow-label">
                        <span class="label-icon">üìÑ</span>
                        Content
                    </label>
                    <div class="content-box" id="content-box">
                        <div class="content-box-content" id="content-box-content">
                            {% if article.content %}
                                {{ article.content|safe|truncatewords:30 }}
                            {% else %}
                                Click to write your content...
                            {% endif %}
                        </div>
                    </div>
                    <input type="hidden" id="content" name="content" value="{{ article.content|default:'' }}">
                    <span id="content-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                </div>

                <div class="form-group">
                    <label for="pdf_file" class="glow-label">
                        <span class="label-icon">üìÑ</span>
                        Upload PDF (Optional)
                    </label>
                    <input type="file" id="pdf_file" name="pdf_file" accept=".pdf" class="glow-input">
                    <span id="pdf_file-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                    {% if article.pdf_file %}
                        <p>Current file: <a href="{{ article.pdf_file.url }}" target="_blank" id="pdf-current-link">{{ article.pdf_file.name|cut:"articles/pdfs/" }}</a></p>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="glow-label">
                        <span class="label-icon">üñºÔ∏è</span>
                        Featured Image
                    </label>
                    <div class="image-upload-container">
                        <div class="image-preview" id="image-preview">
                            {% if article.image %}
                                <img src="{{ article.image.url }}" alt="Current featured image" class="current-image">
                                <button type="button" class="remove-image" id="remove-image">‚úï</button>
                            {% else %}
                                <div class="upload-placeholder">
                                    <span class="upload-icon">üì§</span>
                                    <span class="upload-text">Drag & drop or click to upload</span>
                                </div>
                            {% endif %}
                        </div>
                        <input type="file" id="image" name="image" accept="image/*" class="hidden-upload" onchange="previewImage(event)">
                    </div>
                    <span id="image-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                </div>

                <div class="form-group">
                    <label for="category" class="glow-label">
                        <span class="label-icon">üè∑Ô∏è</span>
                        Category
                    </label>
                    <select id="category" name="category" required class="glow-select">
                        <option value="">Select a category</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" 
                                    {% if article.category_id == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                    <span id="category-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                </div>

                <div class="form-group">
                    <label class="glow-label">
                        <span class="label-icon">üîñ</span>
                        Tags
                    </label>
                    <div class="tags-container">
                        <input type="text" id="tag-input" placeholder="Add tags..." class="glow-input">
                        <div class="tags-list" id="tags-list">
                            <!-- Tags will be added here -->
                        </div>
                        <input type="hidden" name="tags" id="tags-hidden" value="">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" id="draft-btn" class="action-btn draft-btn">
                        <span class="btn-sparkle">üíæ</span>
                        Save Draft
                    </button>
                    <button type="button" id="preview-btn" class="action-btn preview-btn">
                        <span class="btn-sparkle">‚ú®</span>
                        Preview
                    </button>
                    <button type="submit" id="submit-btn" name="action" value="submit" class="action-btn publish-btn">
                        <span class="btn-sparkle">üöÄ</span>
                        Submit for Publishing
                    </button>
                </div>
            </form>
        </main>

        <aside class="side-panel">
            <div class="panel-card tips-panel">
                <div class="panel-header">
                    <span class="panel-icon">üí°</span>
                    <h3>Writing Tips</h3>
                </div>
                <div class="panel-content">
                    <ul class="tips-list">
                        <li>Keep your title under 60 characters</li>
                        <li>Use engaging images for better reach</li>
                        <li>Break content into sections with subheadings</li>
                        <li>Add relevant tags for discoverability</li>
                        <li>Preview before publishing</li>
                    </ul>
                </div>
            </div>

            <div class="panel-card settings-panel">
                <div class="panel-header">
                    <span class="panel-icon">‚öôÔ∏è</span>
                    <h3>Post Settings</h3>
                </div>
                <div class="panel-content">
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" name="featured" id="featured" {% if article.featured %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span>Featured Article</span>
                    </div>
                    <div class="setting-item">
                        <label class="toggle-switch">
                            <input type="checkbox" name="subscriber_only" id="subscriber_only" {% if article.subscriber_only %}checked{% endif %}>
                            <span class="slider"></span>
                        </label>
                        <span>Subscriber Only</span>
                    </div>
                    <div class="setting-item">
                        <label for="publish-date">Schedule Publish:</label>
                        <input type="datetime-local" id="publish-date" name="publish_date" class="glow-input" value="{{ article.publish_date|date:'Y-m-d\TH:i' }}">
                    </div>
                    <span id="publish-date-error" class="error-message" style="color: #ff6b6b; font-size: 0.8rem; display: none;"></span>
                </div>
            </div>

            <div class="panel-card validation-panel">
                <div class="panel-header">
                    <span class="panel-icon">‚úÖ</span>
                    <h3>Validation Status</h3>
                </div>
                <div class="panel-content">
                    <ul class="validation-list" id="validation-list">
                        <!-- Items will be added by JavaScript -->
                    </ul>
                </div>
            </div>
        </aside>
    </div>

    <!-- Preview Modal -->
    <div class="modal" id="preview-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Article Preview</h2>
            <div class="preview-content" id="preview-content">
                <!-- Preview will be rendered here -->
            </div>
            <div class="modal-actions">
                <button class="action-btn close-preview">Close</button>
            </div>
        </div>
    </div>

    <!-- Content Popup -->
    <div class="content-popup" id="content-popup">
        <div class="popup-content">
            <span class="close-popup">&times;</span>
            <h2><i class="fas fa-edit me-2"></i>Write Your Content</h2>
            <textarea id="content-textarea" rows="10" placeholder="Write your content here...">{{ article.content|default:'' }}</textarea>
            <button id="submit-content"><i class="fas fa-save me-2"></i>Save Content</button>
        </div>
    </div>

    <script>
        // --- DOM Element References ---
        const titleInput = document.getElementById('title');
        const descriptionInput = document.getElementById('description');
        const categorySelect = document.getElementById('category');
        const imageInput = document.getElementById('image');
        const pdfInput = document.getElementById('pdf_file');
        const scheduleInput = document.getElementById('publish-date');
        const validationList = document.getElementById('validation-list');
        const publishBtn = document.getElementById('submit-btn');
        const draftBtn = document.getElementById('draft-btn');
        const imagePreview = document.getElementById('image-preview');
        const tagInput = document.getElementById('tag-input');
        const tagsList = document.getElementById('tags-list');
        const tagsHidden = document.getElementById('tags-hidden');
        const previewBtn = document.getElementById('preview-btn');
        const previewModal = document.getElementById('preview-modal');
        const previewContentEl = document.getElementById('preview-content');
        const closeModalBtn = previewModal.querySelector('.close-modal');
        const closePreviewBtn = previewModal.querySelector('.close-preview');
        const contentBox = document.getElementById('content-box');
        const contentBoxContent = document.getElementById('content-box-content');
        const contentInput = document.getElementById('content');
        const contentPopup = document.getElementById('content-popup');
        const closePopupBtn = contentPopup.querySelector('.close-popup');
        const contentTextarea = document.getElementById('content-textarea');
        const submitContentBtn = document.getElementById('submit-content');
        const errorPopup = document.getElementById('error-popup');
        const errorMessage = document.getElementById('error-message');
        let tags = [];

        // --- Validation Constants ---
        const titleRegex = /^[A-Za-z\s\-]{1,100}$/;
        const descriptionRegex = /^[A-Za-z0-9\s.,!?'"()-]{1,250}$/;
        const allowedImageTypes = ['image/jpeg', 'image/png', 'image/webp'];
        const maxImageSize = 2 * 1024 * 1024; // 2MB
        const allowedPdfTypes = ['application/pdf'];
        const maxPdfSize = 5 * 1024 * 1024; // 5MB

        // --- Helper Functions ---
        function displayFieldError(fieldName, message) {
            const errorElement = document.getElementById(`${fieldName}-error`);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = message ? 'block' : 'none';
            }
        }

        function updateValidationStatus(checkName, isValid, message = '') {
            const statusElement = validationList.querySelector(`[data-check="${checkName}"] .status`);
            if (statusElement) {
                let statusText = '';
                let statusColor = '';

                if (isValid) {
                    statusText = `‚úÖ ${message || 'Valid'}`;
                    statusColor = '#51cf66';
                } else {
                    statusText = `‚ùå ${message || 'Invalid'}`;
                    statusColor = '#ff6b6b';
                    if (message === 'Recommended') {
                        statusText = `‚ö†Ô∏è ${message}`;
                        statusColor = '#fcc419';
                    } else if (message === 'Optional') {
                        statusText = `‚ö™ ${message}`;
                        statusColor = '#868e96';
                    }
                }
                statusElement.textContent = statusText;
                statusElement.style.color = statusColor;
            }
            checkFormValidity();
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorPopup.style.display = 'block';
            setTimeout(() => {
                errorPopup.style.display = 'none';
            }, 5000);
        }

        // --- Validation Functions ---
        function validateTitle() {
            const value = titleInput.value;
            const len = value.length;
            document.getElementById('title-count').textContent = len;
            let errorMsg = '';
            let isValid = true;

            if (len === 0) { errorMsg = 'Missing'; isValid = false; }
            else if (len > 100) { errorMsg = 'Max 100 chars'; isValid = false; }
            else if (!titleRegex.test(value)) { errorMsg = 'Invalid chars (only letters, space, -)'; isValid = false; }

            displayFieldError('title', errorMsg);
            updateValidationStatus('title', isValid, errorMsg || 'Valid');
            return isValid;
        }

        function validateDescription() {
            const value = descriptionInput.value.trim();
            const len = value.length;
            let errorMsg = '';
            let isValid = true;

            if (len === 0) { errorMsg = 'Missing'; isValid = false; }
            else if (len > 250) { errorMsg = 'Max 250 chars'; isValid = false; }
            else if (!descriptionRegex.test(value)) { errorMsg = 'Invalid chars'; isValid = false; }

            displayFieldError('description', errorMsg);
            updateValidationStatus('description', isValid, errorMsg || 'Valid');
            return isValid;
        }

        function validateContent() {
            const value = contentInput.value.trim();
            let errorMsg = '';
            let isValid = true;

            if (value.length === 0) { errorMsg = 'Missing'; isValid = false; }
            else if (value.length < 10) { errorMsg = 'Min 10 chars'; isValid = false; }

            displayFieldError('content', errorMsg);
            updateValidationStatus('content', isValid, errorMsg || 'Valid');
            return isValid;
        }

        function validateCategory() {
            let isValid = categorySelect.value !== '';
            let errorMsg = isValid ? '' : 'Missing';
            displayFieldError('category', errorMsg);
            updateValidationStatus('category', isValid, errorMsg || 'Valid');
            return isValid;
        }

        function validateImage() {
            const file = imageInput.files[0];
            const currentImage = imagePreview.querySelector('.current-image');
            let errorMsg = '';
            let isValid = false;
            let statusMsg = 'Recommended';

            if (file) {
                if (!allowedImageTypes.includes(file.type)) {
                    errorMsg = 'Invalid type (JPG, PNG, WEBP)';
                } else if (file.size > maxImageSize) {
                    errorMsg = `Too large (Max ${maxImageSize / 1024 / 1024}MB)`;
                } else {
                    isValid = true;
                    statusMsg = 'Uploaded';
                }
            } else if (currentImage) {
                isValid = true;
                statusMsg = 'Existing';
            } else {
                errorMsg = '';
                statusMsg = 'Recommended';
                isValid = true;
            }

            displayFieldError('image', errorMsg);
            updateValidationStatus('image', !errorMsg, statusMsg || errorMsg);
            return !errorMsg;
        }

        function validatePdf() {
            const file = pdfInput.files[0];
            const currentPdfLink = document.querySelector('#pdf-current-link');
            let errorMsg = '';
            let isValid = true;
            let statusMsg = 'Optional';

            if (file) {
                if (!allowedPdfTypes.includes(file.type)) {
                    errorMsg = 'Invalid type (PDF only)';
                    isValid = false;
                } else if (file.size > maxPdfSize) {
                    errorMsg = `Too large (Max ${maxPdfSize / 1024 / 1024}MB)`;
                    isValid = false;
                } else {
                    statusMsg = 'Selected';
                }
            } else if (currentPdfLink) {
                statusMsg = 'Existing';
            }

            displayFieldError('pdf_file', errorMsg);
            updateValidationStatus('pdf', isValid, statusMsg || errorMsg);
            return isValid;
        }

        function validateSchedule() {
            const scheduleValue = scheduleInput.value;
            let errorMsg = '';
            let isValid = true;
            let statusMsg = 'Optional';

            if (scheduleValue) {
                const scheduledDate = new Date(scheduleValue);
                const now = new Date();
                now.setMinutes(now.getMinutes() - 1);

                if (isNaN(scheduledDate.getTime())) {
                    errorMsg = 'Invalid date/time';
                    isValid = false;
                } else if (scheduledDate <= now) {
                    errorMsg = 'Cannot be in the past';
                    isValid = false;
                } else {
                    statusMsg = 'Scheduled';
                }
            }

            displayFieldError('publish-date', errorMsg);
            updateValidationStatus('schedule', isValid, statusMsg || errorMsg);
            return isValid;
        }

        function checkFormValidity() {
            const isTitleValid = !document.getElementById('title-error')?.textContent;
            const isDescValid = !document.getElementById('description-error')?.textContent;
            const isContentValid = !document.getElementById('content-error')?.textContent;
            const isCategoryValid = !document.getElementById('category-error')?.textContent;
            const isImageValid = !document.getElementById('image-error')?.textContent;
            const isPdfValid = !document.getElementById('pdf_file-error')?.textContent;
            const isScheduleValid = !document.getElementById('publish-date-error')?.textContent;

            publishBtn.disabled = !(isTitleValid && isDescValid && isContentValid && isCategoryValid && isImageValid && isPdfValid && isScheduleValid);
        }

        // --- Event Listeners ---
        titleInput.addEventListener('input', validateTitle);
        descriptionInput.addEventListener('input', validateDescription);
        categorySelect.addEventListener('change', validateCategory);
        imageInput.addEventListener('change', validateImage);
        pdfInput.addEventListener('change', validatePdf);
        scheduleInput.addEventListener('change', validateSchedule);

        // Image Upload Listeners
        imagePreview.addEventListener('click', function(e) {
            if (e.target.id === 'remove-image') {
                imagePreview.innerHTML = 
                    '<div class="upload-placeholder">' +
                    '<span class="upload-icon">üì§</span>' +
                    '<span class="upload-text">Drag & drop or click to upload</span>' +
                    '</div>';
                imageInput.value = '';
                validateImage();
            } else if (!imagePreview.querySelector('.current-image') && !imagePreview.querySelector('.preview-image')) {
                imageInput.click();
            }
        });

        imagePreview.addEventListener('dragover', (e) => {
            e.preventDefault();
            imagePreview.classList.add('dragover');
        });

        imagePreview.addEventListener('dragleave', () => {
            imagePreview.classList.remove('dragover');
        });

        imagePreview.addEventListener('drop', (e) => {
            e.preventDefault();
            imagePreview.classList.remove('dragover');
            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                imageInput.files = e.dataTransfer.files;
                const event = new Event('change', { bubbles: true });
                imageInput.dispatchEvent(event);
            }
        });

        // Tags Input Logic
        tagInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ',') {
                e.preventDefault();
                const tagValue = this.value.trim();
                if (tagValue && !tags.includes(tagValue)) {
                    tags.push(tagValue);
                    renderTags();
                    this.value = '';
                }
            }
        });

        function renderTags() {
            tagsList.innerHTML = '';
            tags.forEach((tag, index) => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = 
                    tag + 
                    '<span class="remove-tag" data-index="' + index + '">‚úï</span>';
                tagsList.appendChild(tagElement);
            });
            tagsHidden.value = JSON.stringify(tags);
        }

        tagsList.addEventListener('click', function(e) {
            if (e.target.classList.contains('remove-tag')) {
                const index = parseInt(e.target.getAttribute('data-index'));
                tags.splice(index, 1);
                renderTags();
            }
        });

        // Preview Modal Logic
        previewBtn.addEventListener('click', function() {
            if (!contentInput.value) {
                showError("Please add some content before previewing");
                return;
            }
            
            // Create preview content
            previewContentEl.innerHTML = `
                <h1>${titleInput.value || 'No Title'}</h1>
                <p class="preview-description">${descriptionInput.value || 'No description provided'}</p>
                <div class="preview-body">
                    ${contentInput.value || '<p>No content available</p>'}
                </div>
            `;
            
            // Show the modal
            previewModal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
        });

        closeModalBtn.addEventListener('click', () => {
            previewModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        closePreviewBtn.addEventListener('click', () => {
            previewModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        previewModal.addEventListener('click', (e) => {
            if (e.target === previewModal) {
                previewModal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        // Content Popup Logic
        contentBox.addEventListener('click', function() {
            contentPopup.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        });

        closePopupBtn.addEventListener('click', () => {
            contentPopup.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
        
        contentPopup.addEventListener('click', (e) => {
            if (e.target === contentPopup) {
                contentPopup.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        });

        submitContentBtn.addEventListener('click', function() {
            const content = contentTextarea.value.trim();
            contentInput.value = content;
            
            // Update content box preview
            if (content.length > 0) {
                // Create a temporary div to strip HTML tags for preview
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                const textContent = tempDiv.textContent || tempDiv.innerText || '';
                contentBoxContent.innerHTML = textContent.substring(0, 150) + (textContent.length > 150 ? '...' : '');
            } else {
                contentBoxContent.innerHTML = 'Click to write your content...';
            }
            
            validateContent();
            contentPopup.style.display = 'none';
            document.body.style.overflow = 'auto';
        });

        // Draft Button Logic
        draftBtn.addEventListener('click', function() {
            // Validate required fields
            const isTitleValid = validateTitle();
            const isContentValid = validateContent();
            
            if (!isTitleValid || !isContentValid) {
                showError("Please fill in required fields (Title and Content) before saving as draft");
                return;
            }
            
            // Set form to save as draft
            document.getElementById('status').value = 'draft';
            
            // Submit the form
            document.getElementById('article-form').submit();
        });

        // Form submission handler
        document.getElementById('article-form').addEventListener('submit', function(e) {
            // Make sure tags are included in form data
            this.querySelector('#tags-hidden').value = JSON.stringify(tags);
            
            // For publishing, validate all fields
            if (this.querySelector('#status').value !== 'draft') {
                const isTitleValid = validateTitle();
                const isDescValid = validateDescription();
                const isContentValid = validateContent();
                const isCategoryValid = validateCategory();
                const isImageValid = validateImage();
                const isPdfValid = validatePdf();
                const isScheduleValid = validateSchedule();
                
                if (!isTitleValid || !isDescValid || !isContentValid || !isCategoryValid || !isImageValid || !isPdfValid || !isScheduleValid) {
                    e.preventDefault();
                    showError("Please fix all validation errors before submitting.");
                    return;
                }
            }
            
            // If all validations pass, the form will submit normally
        });

        // Background Slideshow
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        
        function showSlide(n) {
            slides[currentSlide].classList.remove('active');
            currentSlide = (n + slides.length) % slides.length;
            slides[currentSlide].classList.add('active');
        }
        
        function nextSlide() {
            showSlide(currentSlide + 1);
        }
        
        setInterval(nextSlide, 5000); // Change slide every 5 seconds

        // --- Dynamic Validation List Initialization ---
        function addValidationListItem(checkName, defaultStatus = 'Missing', isOptional = false) {
            const li = document.createElement('li');
            li.setAttribute('data-check', checkName);
            let initialText = isOptional ? 'Optional' : '‚ùå ' + defaultStatus;
            let initialColor = isOptional ? '#868e96' : '#ff6b6b';
            li.innerHTML = 
                checkName.charAt(0).toUpperCase() + checkName.slice(1) + 
                ': <span class="status" style="color: ' + initialColor + ';">' + initialText + '</span>';
            validationList.appendChild(li);
        }

        validationList.innerHTML = '';
        addValidationListItem('title');
        addValidationListItem('description');
        addValidationListItem('content');
        addValidationListItem('category');
        addValidationListItem('image', 'Recommended', true);
        addValidationListItem('pdf', 'Optional', true);
        addValidationListItem('schedule', 'Optional', true);

        // Load existing tags if editing
        {% if article.tags %}
            try {
                const existingTags = JSON.parse('{{ article.tags|escapejs|default:"[]" }}');
                if (Array.isArray(existingTags)) {
                    tags = existingTags;
                    renderTags();
                }
            } catch (e) {
                console.error("Error parsing existing tags:", e);
            }
        {% endif %}

        // Initial validation check for all fields
        validateTitle();
        validateDescription();
        validateContent();
        validateCategory();
        validateImage();
        validatePdf();
        validateSchedule();

        function previewImage(event) {
            const imagePreview = document.getElementById('image-preview');
            const file = event.target.files[0];

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.createElement('img');
                    imgElement.src = e.target.result;
                    imgElement.alt = "Uploaded Image";
                    imgElement.className = "preview-image";

                    imagePreview.innerHTML = '';
                    imagePreview.appendChild(imgElement);
                    
                    // Add remove button
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-image';
                    removeBtn.id = 'remove-image';
                    removeBtn.innerHTML = '‚úï';
                    imagePreview.appendChild(removeBtn);
                    
                    validateImage();
                }
                reader.readAsDataURL(file);
            } else {
                imagePreview.innerHTML = '<div class="upload-placeholder"><span class="upload-icon">üì§</span><span class="upload-text">Drag & drop or click to upload</span></div>';
            }
        }
    </script>
</body>
</html>